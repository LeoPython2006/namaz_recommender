image: docker:26
services:
  - docker:dind

# GitLabâ€™s Docker-in-Docker needs this
variables:
  DOCKER_TLS_CERTDIR: ""       # disable TLS inside DinD for simplicity

stages: [test, build]

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ tests only â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
unit-tests:
  stage: test
  script:
    - echo "ğŸ” run your npm / pytest / go test commands here"
  tags: [docker]

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ optional container build â”€â”€â”€â”€â”€
docker-build:
  stage: build
  rules:
    # skip the whole job unless you deliberately enabled it
    - if: '$BUILD_DOCKER_IMAGE == "true"'
  script:
    # log in to GitLab registry (credentials are injected automatically)
    - echo "$CI_REGISTRY_PASSWORD" | docker login -u "$CI_REGISTRY_USER" --password-stdin "$CI_REGISTRY"
    # build & push
    - docker build -t "$CI_REGISTRY_IMAGE:$CI_COMMIT_SHORT_SHA" .
    - docker push "$CI_REGISTRY_IMAGE:$CI_COMMIT_SHORT_SHA"
  tags: [docker]
ba
# .gitlab-ci.yml
stages:
  - build

variables:
  DOCKER_TLS_CERTDIR: ""  # Ğ½ÑƒĞ¶Ğ½Ğ¾ Ğ´Ğ»Ñ docker:dind Ğ±ĞµĞ· TLS

docker-build:
  stage: build
  image: docker:24
  services:
    - docker:dind
  before_script:
    # Ğ‘ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ñ‹Ğ¹ Ğ»Ğ¾Ğ³Ğ¸Ğ½
    - echo "$CI_REGISTRY_PASSWORD" | docker login -u "$CI_REGISTRY_USER" --password-stdin
  script:
    - docker build -t "$CI_REGISTRY_USER/myimage:latest" .
    - docker push "$CI_REGISTRY_USER/myimage:latest"
